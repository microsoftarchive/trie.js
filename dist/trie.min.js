(function(n){"use strict";var e={},r=n;"undefined"!=typeof module?module.exports=e:"function"==typeof r.define&&define.amd?define("trie",function(){return e}):r.T=e,function(n){function e(n){return n?(n^16*Math.random()>>n/4).toString(16):o.replace(/[018]/g,e)}function r(n){return n instanceof Array}function t(n){return"[object String]"===i.call(n)}var o="10000000-1000-4000-8000-100000000000",i=Object.prototype.toString;n.helpers={isArray:r,isString:t,uuid:e}}.call(null,e),function(n){function e(n){if(n instanceof Array){var e=[];return n.forEach(function(n){n&&e.push(n)}),e}}function r(n){if(n instanceof Array&&(n=n.join(" ")),n&&n.length){var r=n.toLowerCase().split(/[\s\'\"\.\-_;]+/);return e(r)}}n.tokenizer={whitespace:r}}.call(null,e),function(n,e){n.resolver=function(n){return function(r,t){var o=n._trie,i=r.split("");return i.some(function(n){if(!/[\s\'\"\.\-_]+/.test(n)){if(o[n]===e){if(!t)return o=e,!0;o[n]={}}o=o[n]}}),o}}}.call(null,e),function(n,e){n.indexer=function(n,r){return function(t,o,i){if(o!==e){i=i||1;var c=n._tokenize(o)||[];c.forEach(function(e){var o=n._resolve(e,!0);if(o[";"]=o[";"]||[],o[";"].push(t),r&&e.length>2)for(var i=1,c=e.length-1;c>i;i++)o=n._resolve(e.substr(i),!0),o[";"]=o[";"]||[],o[";"].push(t)})}}}}.call(null,e),function(n,e){function r(n){var e=[];if(!n)return e;var t,o;for(t in n)";"!==t&&(e=e.concat(r(n[t])));return n[";"]instanceof Array&&(o=n[";"],e=e.concat(o)),e}function t(n,e){var r=[];return n.length&&e.length&&n.forEach(function(n){-1!==e.indexOf(n)&&-1===r.indexOf(n)&&r.push(n)}),r}n.searcher=function(n,o){return function(i){if(i===e)return[];var c=n._tokenize(i)||[],u=[];if(c.forEach(function(e){var t=n._resolve(e);u.push(r(t))}),u.length){var a=u;if(u=[],!a.length)return u;if(o)for(u=a.shift();a.length&&u.length;)u=t(u,a.shift());else a.forEach(function(n){n.forEach(function(n){-1===u.indexOf(n)&&u.push(n)})})}return u}}}.call(null,e),function(n,e){function r(n){var e=n.target.result.db||n.target.result;e.createObjectStore(a)}function t(n){var e=f.open(c,u);e.onupgradeneeded=r,e.onsuccess=function(e){var r=e.target.result;n(null,r)},e.onerror=function(){var e=Error("failed opening database");n(e)}}function o(n){return function(e){e&&e.call||(e=function(){}),t(function(r,t){if(r)return e(r);var o=t.transaction([a],"readwrite"),i=o.objectStore(a),c=i.put(n._trie,n._name);c.onsuccess=function(){t.close(),e(null)},c.onerror=function(){t.close();var r=Error("failed saving the trie "+n._name);e(r)}})}}function i(n){return function(e){e&&e.call||(e=function(){}),t(function(r,t){if(r)return e(r);var o=t.transaction([a],"readonly"),i=o.objectStore(a),c=i.get(n._name);c.onsuccess=function(r){t.close();var o=r.target.result;if(o)n._trie=o,e(null);else{var i=Error("first load");e(i)}},c.onerror=function(){t.close();var r=Error("failed loading the trie "+n._name);e(r)}})}}var c="trie.js",u="1.0",a="indices",f=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB;n.storage=n.storage||{},n.storage.indexeddb={isSupported:!!f,saver:o,loader:i}}.call(null,e,r),function(n){function e(n){for(var r,t={},o=!1,i="",c=n;!o;)r=Object.keys(c),1===r.length&&";"!==r[0]?(i+=r[0],c=c[r[0]]):o=!0;var u=t;return i.length>0&&(u=t[i]={}),r.forEach(function(n){if(";"===n)u[";"]=c[";"];else{var r={};r[n]=c[n],r=e(r),Object.keys(r).forEach(function(n){u[n]=r[n]})}}),t}function r(n){var e={},t=e;return Object.keys(n).forEach(function(e){var o=t;if(";"===e)o[";"]=n[";"];else for(var i=e.split("");i.length;){var c=i.shift();0===i.length?o[c]=r(n[e]):(o[c]=o[c]||{},o=o[c])}}),e}function t(n){return function(){return e(n._trie)}}function o(n){return function(e){n._trie=r(e)}}n.codec={compresser:t,decompresser:o}}.call(null,e),function(n){function e(n){return function(e){return[n,e]}}function r(n){return function(){return{index:n}}}n.porter={importer:e,exporter:r}}.call(null,e),function(n){function e(e){e=e||{},n.helpers.isString(e)&&(e={name:e});var r=this;r._trie={};var t=e.indexSubstring?!0:!1,o=e.intersectResults?!0:!1;r._name=e.name||n.helpers.uuid(),r._tokenize=n.tokenizer[e.tokenizer]||n.tokenizer.whitespace,r._resolve=n.resolver(r),r.add=n.indexer(r,t),r.search=n.searcher(r,o);var i=n.storage.indexeddb;return i.isSupported&&(r.save=i.saver(r),r.load=i.loader(r)),r.compress=n.codec.compresser(r),r.decompress=n.codec.decompresser(r),r}n.Index=e}.call(null,e)}).call(null,this);