(function(n){"use strict";var e={},r=n;"undefined"!=typeof module?module.exports=e:"function"==typeof r.define&&define.amd?define("trie",function(){return e}):r.T=e,function(n){function e(n){return n?(n^16*Math.random()>>n/4).toString(16):o.replace(/[018]/g,e)}function r(n){return n instanceof Array}function t(n){return"[object String]"===i.call(n)}var o="10000000-1000-4000-8000-100000000000",i=Object.prototype.toString;n.helpers={isArray:r,isString:t,uuid:e}}.call(null,e),function(n){function e(n){if(n instanceof Array){var e=[];return n.forEach(function(n){n&&e.push(n)}),e}}function r(n){if(n instanceof Array&&(n=n.join(" ")),n&&n.length){var r=n.toLowerCase().split(/[\s\'\"\.\-_;]+/);return e(r)}}n.tokenizer={whitespace:r}}.call(null,e),function(n,e){n.resolver=function(n){return function(r,t){var o=n._trie,i=r.split("");return i.some(function(n){if(!/[\s\'\"\.\-_]+/.test(n)){if(o[n]===e){if(!t)return o=e,!0;o[n]={}}o=o[n]}}),o}}}.call(null,e),function(n,e){n.indexer=function(n,r){return function(t,o,i){if(o!==e){i=i||1;var u=n._tokenize(o)||[];u.forEach(function(e){var o=n._resolve(e,!0);if(o[";"]=o[";"]||[],o[";"].push(t),r&&e.length>2)for(var i=1,u=e.length-1;u>i;i++)o=n._resolve(e.substr(i),!0),o[";"]=o[";"]||[],o[";"].push(t)})}}}}.call(null,e),function(n,e){function r(n){var e=[];if(!n)return e;var t,o;for(t in n)";"!==t&&(e=e.concat(r(n[t])));return n[";"]instanceof Array&&(o=n[";"],e=e.concat(o)),e}n.searcher=function(n){return function(t){if(t===e)return[];var o=n._tokenize(t)||[],i=[];if(o.forEach(function(e){var t=n._resolve(e);i.push(r(t))}),i.length){var u=i;i=[],u.forEach(function(n){n.forEach(function(n){-1===i.indexOf(n)&&i.push(n)})})}return i}}}.call(null,e),function(n,e){function r(n){var e=n.target.result.db||n.target.result;e.createObjectStore(c)}function t(n){var e=f.open(u,a);e.onupgradeneeded=r,e.onsuccess=function(e){var r=e.target.result;n(null,r)},e.onerror=function(){var e=Error("failed opening database");n(e)}}function o(n){return function(e){e&&e.call||(e=function(){}),t(function(r,t){if(r)return e(r);var o=t.transaction([c],"readwrite"),i=o.objectStore(c),u=i.put(n._trie,n._name);u.onsuccess=function(){t.close(),e(null)},u.onerror=function(){t.close();var r=Error("failed saving the trie "+n._name);e(r)}})}}function i(n){return function(e){e&&e.call||(e=function(){}),t(function(r,t){if(r)return e(r);var o=t.transaction([c],"readonly"),i=o.objectStore(c),u=i.get(n._name);u.onsuccess=function(r){t.close();var o=r.target.result;if(o)n._trie=o,e(null);else{var i=Error("first load");e(i)}},u.onerror=function(){t.close();var r=Error("failed loading the trie "+n._name);e(r)}})}}var u="trie.js",a="1.0",c="indices",f=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB;n.storage=n.storage||{},n.storage.indexeddb={isSupported:!!f,saver:o,loader:i}}.call(null,e,r),function(n){function e(n){for(var r,t={},o=!1,i="",u=n;!o;)r=Object.keys(u),1===r.length&&";"!==r[0]?(i+=r[0],u=u[r[0]]):o=!0;var a=t;return i.length>0&&(a=t[i]={}),r.forEach(function(n){if(";"===n)a[";"]=u[";"];else{var r={};r[n]=u[n],r=e(r),Object.keys(r).forEach(function(n){a[n]=r[n]})}}),t}function r(n){return function(e){return[n,e]}}function t(n){return function(){return{index:n}}}n.porter={compress:e,importer:r,exporter:t}}.call(null,e),function(n){function e(e){e=e||{},n.helpers.isString(e)&&(e={name:e});var r=this;r._trie={};var t=e.indexSubstring?!0:!1;r._name=e.name||n.helpers.uuid(),r._tokenize=n.tokenizer[e.tokenizer]||n.tokenizer.whitespace,r._resolve=n.resolver(r),r.add=n.indexer(r,t),r.search=n.searcher(r);var o=n.storage.indexeddb;return o.isSupported&&(r.save=o.saver(r),r.load=o.loader(r)),r}n.Index=e}.call(null,e)}).call(null,this);